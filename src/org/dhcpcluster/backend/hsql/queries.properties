#
#	This file is part of dhcp4java, a DHCP API for the Java language.
#	(c) 2006 Stephan Hadinger
#
#	This library is free software; you can redistribute it and/or
#	modify it under the terms of the GNU Lesser General Public
#	License as published by the Free Software Foundation; either
#	version 2.1 of the License, or (at your option) any later version.
#
#	This library is distributed in the hope that it will be useful,
#	but WITHOUT ANY WARRANTY; without even the implied warranty of
#	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
#	Lesser General Public License for more details.
#
#	You should have received a copy of the GNU Lesser General Public
#	License along with this library; if not, write to the Free Software
#	Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
#


SHUTDOWN=SHUTDOWN
SHUTDOWN_COMPACT=SHUTDOWN COMPACT
IDENTITY=CALL IDENTITY()

DELETE_T_POOL=DELETE FROM T_POOL
DELETE_T_POOL_SET=DELETE FROM T_POOL_SET
DELETE_T_BUBBLE=DELETE FROM T_BUBBLE

INSERT_T_POOL_SET=INSERT INTO T_POOL_SET (SET_ID) VALUES (?)
INSERT_T_POOL=INSERT INTO T_POOL (START_IP, END_IP, CLASSES, SET_ID) VALUES (?,?,?,?)

SELECT_LEASE=SELECT IP, CREATION_DATE, UPDATE_DATE, EXPIRATION_DATE, RECYCLE_DATE, MAC, UID, STATUS FROM T_LEASE WHERE IP=?
SELECT_LEASE_RANGE=SELECT IP, CREATION_DATE, UPDATE_DATE, EXPIRATION_DATE, RECYCLE_DATE, MAC, UID, STATUS FROM T_LEASE WHERE IP>=? AND IP<=? AND STATUS>0 ORDER BY IP
SELECT_LEASE_MAC=SELECT IP, CREATION_DATE, UPDATE_DATE, EXPIRATION_DATE, RECYCLE_DATE, MAC, UID, STATUS FROM T_LEASE WHERE MAC=? AND STATUS>=0 ORDER BY IP
SELECT_LEASE_ACTIVE_ICC=SELECT IP, CREATION_DATE, UPDATE_DATE, EXPIRATION_DATE, RECYCLE_DATE, MAC, UID, STATUS FROM T_LEASE WHERE ICC=? AND STATUS IN (1,2)
INSERT_LEASE=INSERT INTO T_LEASE (IP, CREATION_DATE, UPDATE_DATE, EXPIRATION_DATE, RECYCLE_DATE, MAC, UID, STATUS) VALUES(?,?,?,?,?,?,?,?)
UPDATE_LEASE=UPDATE T_LEASE SET CREATION_DATE=?, UPDATE_DATE=?, EXPIRATION_DATE=?, RECYCLE_DATE=?, MAC=?, UID=?, STATUS=? WHERE IP=?

INSERT_T_BUBBLE=INSERT INTO T_BUBBLE (POOL_ID, START_IP, END_IP) VALUES (?,?,?)
SELECT_BUBBLE_FROM_POOL_SET=SELECT BUBBLE_ID, POOL_ID, START_IP, END_IP FROM T_BUBBLE WHERE START_IP=\
							SELECT MIN(START_IP) FROM T_BUBBLE WHERE POOL_ID IN \
							(SELECT START_IP FROM T_POOL WHERE SET_ID=?)
# bubble_id and pool_id cannot be changed
UPDATE_BUBBLE=UPDATE T_BUBBLE SET START_IP=:startip, END_IP=:endip WHERE BUBBLE_ID=:bubbleid
DELETE_BUBBLE=DELETE FROM T_BUBBLE WHERE BUBBLE_ID=?
SELECT_BUBBLE_CONTAINING_IP=SELECT BUBBLE_ID, POOL_ID, START_IP, END_IP FROM T_BUBBLE WHERE START_IP<=:ip AND END_IP>=:ip AND POOL_ID IN (SELECT START_IP FROM T_POOL WHERE SET_ID=:poolid)

INSERT_T_LEASE_ARCHIVE=INSERT INTO T_LEASE_ARCHIVE (IP,CREATION_DATE,UPDATE_DATE,EXPIRATION_DATE,MAC,UID,PREV_STATUS) \
						VALUES(?,?,?,?,?,?,?)

SELECT_T_POOL_RANGES_FROM_SET_ID=SELECT START_IP, END_IP FROM T_POOL WHERE SET_ID=? ORDER BY START_IP

SELECT_GC_LEASE_RANGE=SELECT IP FROM T_LEASE WHERE IP>=:startip AND IP<=:endip AND STATUS>0 AND RECYCLE_DATE<:now
SELECT_GC_LEASE=SELECT IP FROM T_LEASE WHERE STATUS>0 AND RECYCLE_DATE<:now

CALL_DHCP_DISCOVER=CALL DHCP_DISCOVER(:poolid, :mac, :iccquota, :icc, :offertime)
CALL_DHCP_REQUEST=CALL DHCP_REQUEST(:poolid, :requestedip, :leasetime, :margin, :mac, :optimistic)